$(document).ready(function(){var D,E,F,G,U;function la(){H=!1;b=window.innerWidth-5;e=window.innerHeight-5;$("canvas").attr("width",b);$("canvas").attr("height",e);b<e?($("canvas").hide(),$(".message").text("Please rotate into landscape or make your window wider.")):($("canvas").show(),$(".message").text(""));l=Math.floor(0.025*e);r=Math.floor(0.006*e);m=Math.floor(0.0037*b);n=Math.floor(0.006*b);s=Math.floor(0.016*b);t=Math.floor(0.008*b);P=b/16;Q=e/2+b/14;q.forEach(function(a){a.x=Math.random()*
b});d.width=u?0.04*b:0.025*b;d.height=d.width;d.speed=0.006*b;f.forEach(function(a){a.width=u?0.04*b:0.025*b;a.height=a.width;a.speed=m});for(var a=0;10>a;a++)f[a].x=0.0625*a*b;p.forEach(function(a){a.speed=r;a.width=t;a.height=a.width});k.forEach(function(a){a.constructor==ca?(a.speed=l,a.width=n,a.height=s):a.constructor==ma&&(a.width=3*n,a.height=e)});setTimeout(function(){H=!0},400)}function ta(){if(H&&180<g&&0==g%330){V=!1;K="single";I=0;J=350;w="normal";allStar.pause();!0===W&&(l*=5,r*=5,m*=
5,x/=5,y*=5,da=1,f.forEach(function(a){a.speed*=5}),p.forEach(function(a){a.speed*=5}),k.forEach(function(a){a.speed*=5}),q.forEach(function(a){a.speed*=5}),W=!1);var a=function(){L=Math.floor(11*Math.random())};for(a();0==L&&"f"==M;)a();for(;4==L&&4E3>g;)a();for(;1==L&&1E3>g;)a();switch(L){case 0:M=(parseInt(M,16)+2).toString(16);h="PARTY HARDER!";break;case 1:d.speed+=0.5;f.forEach(function(a){a.speed+=0.5});m+=0.5;l+=0.5;r+=0.5;k.forEach(function(a){a.speed+=0.5});p.forEach(function(a){a.speed+=
0.5});h="SPEED UP!";break;case 2:f.forEach(function(a){a.speed+=0.5});m+=0.5;x+=100;h="HARDER ALIENS!";break;case 3:l+=1;n+=1;s+=1;t+=1;k.forEach(function(a){a.speed+=1;a.width+=1;a.height+=1});p.forEach(function(a){a.width+=1;a.height+=1});h="BIGGER BULLETS!";break;case 4:l/=5;r/=5;m/=5;x*=5;y/=5;da=5;f.forEach(function(a){a.speed/=5});p.forEach(function(a){a.speed/=5});k.forEach(function(a){a.speed/=5});q.forEach(function(a){a.speed/=5});W=!0;h="SLOW MO!";break;case 5:V=!0;h="IMMUNE TO BULLETS (5 SEC)";
break;case 6:K="double";I=1;J=350;h="DOUBLE BULLETS!";break;case 7:K="double";I=2;J=350;h="TRIPLE BULLETS!";break;case 8:K="laser";J=700;h="IMMA FIRIN MAH LASER!";break;case 9:w="shrek";bgMusic.pause();allStar.currentTime=0;h="SPACE SWAMP INCOMING!";break;case 10:J=87.5;h="RAPID FIRE!";break;default:h="NO BONUS."}z=0.1;ea=g}}function na(a){return 0<document.cookie.length&&(c_start=document.cookie.indexOf(a+"="),-1!=c_start)?(c_start=c_start+a.length+1,c_end=document.cookie.indexOf(";",c_start),-1==
c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):0}function ca(a){a.active=!0;a.speed=l;a.width=n;a.height=s;a.colour="#F0F";a.draw=function(){c.fillStyle=this.colour;c.fillRect(this.x,this.y,this.width,this.height)};a.update=function(){a.y-=a.speed;a.x+=a.xSpeed;a.active=a.active&&0<=a.x&&a.x<=b&&0<=a.y&&a.y<=e};return a}function ma(a){a.active=!0;a.width=3*n;a.height=e;a.colour="#F60";a.start=g;a.alpha=1;a.draw=function(){c.fillStyle=this.colour;c.globalAlpha=
this.alpha;c.fillRect(this.x,this.y,this.width,this.height);c.globalAlpha=1};a.update=function(){this.start>g-20&&(this.alpha-=0.1,0.1>this.alpha&&(this.active=!1))};return a}function ua(a){a.active=!0;a.speed=r;a.width=t;a.height=a.width;a.colour="#F00";a.draw=function(){c.fillStyle=this.colour;c.fillRect(this.x,this.y,this.width,this.height)};a.update=function(){a.y+=a.speed;a.active=a.active&&0<=a.x&&a.x<=b&&0<=a.y&&a.y<=e};return a}function va(a){a.active=!0;a.width=u?0.04*b:0.025*b;a.height=
a.width;a.alpha=1;a.speed=m;a.state="alive";a.draw=function(){if(this.active){var a;a="normal"==w?document.getElementById("alien"):document.getElementById("farquaad");c.globalAlpha=this.alpha;c.drawImage(a,this.x,this.y,this.width,this.height);c.globalAlpha=1}};a.update=function(){"down"==a.yDirection&&(a.y+=a.speed,a.y>=a.originalY+Math.floor(0.0625*b)&&(a.yDirection=""));"left"==A?a.x-=a.speed:"right"==A&&(a.x+=a.speed)};a.direction=function(){1>=a.x&&"left"==A?(A="right",X()):a.x>b-a.width&&"right"==
A&&(A="left")};return a}function fa(a){a.active=!0;a.x=Math.random()*b;a.height=a.width;a.colour="#CCC";a.draw=function(){c.fillStyle=this.colour;c.fillRect(this.x,this.y,this.width,this.height)};a.update=function(){a.y+=a.speed;a.active=a.active&&0<=a.x&&a.x<=b&&0<=a.y&&a.y<=e};return a}function B(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y}function wa(){k.forEach(function(a){f.forEach(function(b){B(a,b)&&"alive"==b.state&&(a.active=!1,b.state="dying")})});f.forEach(function(a){"alive"==
a.state&&B(d,a)&&(a.state="dying",d.state="dying")});!1===V&&p.forEach(function(a){B(d,a)&&(d.state="dying")});f.forEach(function(a){a.y+a.height-1>=e&&a.active&&(d.state="dying")})}function oa(a){a.alpha-=0.04;0.01>a.alpha&&(a.state="dead",a.active=!1,a==d&&(ga=!1,g=0,allStar.pause(),bgMusic.pause(),bgMusic.currentTime=0,v>highScore&&("undefined"!==typeof chrome?chrome.storage?chrome.storage.sync.set({highscore:v+1}):pa("highscore",v+1,"90"):pa("highscore",v+1,"90"))))}function X(){for(var a=0;10>
a;a++)f.push(va({x:0.0625*a*b,y:0,width:1,height:1}));f.forEach(function(a){a.originalY=a.y;a.yDirection="down"})}function qa(a){a||(a=event);a.preventDefault();ha=a.targetTouches.length;for(var b=0;b<ha;b++)N[b]={x:a.targetTouches[b].pageX-O.offsetLeft,y:a.targetTouches[b].pageY-O.offsetTop,width:1,height:1}}function xa(){ta();if(Y)for(var a=0;a<ha;a++)B(N[a],R.left)?(D=E=F=!1,G=!0):B(N[a],R.right)?(G=D=F=!1,E=!0):B(N[a],R.up)?(G=E=F=!1,D=!0):B(N[a],R.down)&&(G=E=D=!1,F=!0),B(N[a],ra)&&(U=!0);else G=
E=D=F=U=!1;if("alive"==d.state){if(keydown.left||keydown.a||G)d.x-=d.speed;else if(keydown.right||keydown.d||E)d.x+=d.speed;else if(keydown.up||keydown.w||D)d.y-=d.speed;else if(keydown.down||keydown.s||F)d.y+=d.speed;if(keydown.left||keydown.right||keydown.up||keydown.down)sa=!0;if(keydown.a||keydown.d||keydown.w||keydown.s)ia=!0;if(keydown.space||U)S=!0,!1===Z&&(d.shoot(),Z=!0,setTimeout(function(){Z=!1},J))}0>=d.x&&(d.x=0);d.x>=b-d.width&&(d.x=b-d.width);0>=d.y&&(d.y=0);d.y>=e-d.height&&(d.y=e-
d.height);k.forEach(function(a){a.update()});k=k.filter(function(a){return a.active});p.forEach(function(a){a.update()});p=p.filter(function(a){return a.active});0==f.filter(function(a){return a.active}).length&&(X(),A="right");f.forEach(function(a){a.active&&a.direction()});f.forEach(function(a){a.update();"dying"==a.state&&oa(a)});for(a=0;10>a;a++)for(var c=0;c<Math.floor(f.length/10);c++)f[10*c+a].x=f[a].x;q.forEach(function(a){a.update()});q=q.filter(function(a){return a.active});wa();"dying"==
d.state&&oa(d);v+=1;"normal"==w?(bgMusic.play(),allStar.pause()):(allStar.play(),bgMusic.pause());1>z&&""!=h&&100>g-ea?z+=0.1:""!=h&&100<=g-ea&&(z-=0.1);0.1>=z&&(h="");keydown.m&&!aa&&(bgMusic.muted||allStar.muted?(bgMusic.muted=!1,oneFX.muted=!1,twoFX.muted=!1,threeFX.muted=!1,allStar.muted=!1):(bgMusic.muted=!0,oneFX.muted=!0,twoFX.muted=!0,threeFX.muted=!0,allStar.muted=!0),aa=!0,setTimeout(function(){aa=!1},400))}function ya(){c.clearRect(0,0,b,e);c.fillStyle=ja;c.fillRect(0,0,b,e);"normal"!=
w&&(c.globalAlpha=0.3,c.drawImage(document.getElementById("farfaraway"),0,0,b,e),c.globalAlpha=1);"dead"!=d.state&&d.draw();q.forEach(function(a){a.draw()});f.forEach(function(a){a.draw()});k.forEach(function(a){a.draw()});p.forEach(function(a){a.draw()});starWidth=4*Math.random();q.push(fa({y:0,width:starWidth,speed:(5+5*starWidth)*y}));if(!1===ba&&f[0]){for(var a=Math.floor(Math.random()*f.length);!f[a].active;)a=Math.floor(Math.random()*f.length);p.push(ua({x:f[a].x,y:f[a].y}));ba=!0;setTimeout(function(){ba=
!1},x)}c.font=b/42+"px PressStart2P";c.fillStyle="#FFF";c.textAlign="left";c.fillText("SCORE:"+v,10,e);c.font=b/32+"px PressStart2P";c.fillStyle="rgba(255, 255, 255, "+z+")";c.textAlign="center";c.fillText(h,b/2,b/23);c.fillStyle="#F0F";c.fillRect(0,0,(g+330)%330/330*b,5);u&&(R.draw(),ra.draw())}function za(){M="3";c.clearRect(0,0,b,e);d.x=b/2;d.y=e-60;d.alpha=1;d.state="alive";ba=Z=!1;X();A="right";v=0;d.speed=0.006*b;ka=3;P=b/16;Q=e/2+b/14;l=Math.floor(0.025*e);r=Math.floor(0.006*e);m=Math.floor(0.0037*
b);n=Math.floor(0.003*b);s=Math.floor(0.008*b);t=Math.floor(0.004*b);x=700;L=0;h="";V=W=!1;y=1;I=0;K="single";J=350;w="normal";u&&(n*=4,s*=4,t*=4);f=[];k=[];p=[];q=[];for(var a=0;40>a;a++)starWidth=4*Math.random(),q.push(fa({y:Math.random()*e,width:starWidth,speed:(5+5*starWidth)*y}))}function Aa(){c.clearRect(0,0,b,e);"undefined"!==typeof chrome?chrome.storage?chrome.storage.sync.get("highscore",function(a){highScore=a.highscore||0}):highScore=na("highscore"):highScore=na("highscore");if(ga){textColor=
"#FFF";var a="BEGIN RAVE"}else textColor="#F00",a="GAME OVER";c.font=b/16+"px PressStart2P";c.fillStyle=textColor;c.textAlign="center";c.fillText(a,b/2,e/2-b/16);0==g%60&&ka--;P+=b/3200;Q+=b/3200/2;ga||(c.font=b/32+"px PressStart2P",c.fillText("Score:"+v,b/2,e/2+b/7),c.fillStyle="#F00");c.font=b/51+"px PressStart2P";c.fillText("Highscore:"+highScore,b/2,e/2+b/5);c.font=P+"px PressStart2P";c.fillText(ka,b/2,Q);c.font=b/64+"px PressStart2P";a=u?"Use on-screen controls to move and shoot":sa?ia?S?C?"":
"You can also click to shoot!":C?"You can also space to shoot.":"You can use click or space to shoot.":S?C?"You can also use WASD to move":"You can also use WASD to move, and click to shoot!":C?"You can also use WASD to move, and space to shoot!":"You can also use WASD to move, click or space to shoot.":ia?S?C?"You can also use arrows to move.":"You can also use arrows to move or click to shoot!":C?"You can also use arrows to move or space to shoot!":"You can also use arrows to move, click or space to shoot.":
S?C?"Arrows or WASD to move":"Arrows or WASD to move, you can also click to shoot!":C?"Arrows or WASD to move, you can also use space to shoot!":"Arrows or WASD to move, click or space to shoot.";c.fillText(a,b/2,e/2+b/6)}var b=window.innerWidth-3,e=window.innerHeight-3;$("canvas").attr("width",b);$("canvas").attr("height",e);b<e?($("canvas").hide(),u?$(".message").text("Please rotate into landscape."):$(".message").text("Please rotate into landscape or make your window wider.")):($("canvas").show(),
$(".message").text(""));$(window).on("resize",la);$(window).on("orientationchange",la);var O=document.getElementById("canvas"),c=O.getContext("2d");c.clearRect(0,0,b,e);c.font=b/13+"px PressStart2P";c.fillStyle="#FFF";c.textAlign="center";c.fillText("LOADING",b/2,e/2);var g=0,H=!0,aa=!1;setInterval(function(){$(window).focus(function(){H=!0;"normal"==w?bgMusic.play():allStar.play()});$(window).blur(function(){H=!1;bgMusic.pause();allStar.pause()});H&&(180<g?(xa(),ya()):0==g?c.clearRect(0,0,b,e):180==
g?za():Aa(),g++,1==g?(threeFX.currentTime=0,threeFX.play()):60==g?(twoFX.currentTime=0,twoFX.play()):120==g&&(oneFX.currentTime=0,oneFX.play()))},1E3/60);var ja,aa=!1;setInterval(function(){if(H){for(var a=M,b=ja,c=M+"00",d=[0,0,0];d.join("")==a+a+a||"000"==d.join("")||d.join("")==c||"F0F"==d.join("")||"#"+d.join("")==b;)for(var e=0;e<d.length;e++)0.5>Math.random()?d[e]=a:d[e]="0";ja="#"+d.join("")}},350);var ea,z,L,h="",W=!1;$(function(){window.keydown={};$(document).bind("keydown",function(a){keydown[jQuery.hotkeys.specialKeys[a.which]||
String.fromCharCode(a.which).toLowerCase()]=!0});$(document).bind("keyup",function(a){keydown[jQuery.hotkeys.specialKeys[a.which]||String.fromCharCode(a.which).toLowerCase()]=!1})});var pa=function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+b+c+"; path=/"};u&&window.scrollTo(0,1);var k=[],p=[],f=[],q=[],Z=!1,ba=!1,A="right",v=0,I=0,sa=!1,ia=!1,S=!1,C=!1,M="3",l=Math.floor(0.025*e),r=Math.floor(0.006*e),m=Math.floor(0.0037*
b),n=Math.floor(0.006*b),s=Math.floor(0.016*b),t=Math.floor(0.008*b),da=1,J=350;u&&(n*=4,s*=4,t*=4);var x=700,V=!1,K="single",w="normal",y=1,N=[],Y=U=F=D=E=G=!1,ha=0,u="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;X();for(var T=u?0.04*b:0.025*b,d={colour:"#0BF",x:b/2,y:e-60,width:T,height:T,speed:0.006*b,alpha:1,state:"alive",draw:function(){this.x+=Math.random()-0.5;this.y+=Math.random()-0.5;var a;a="normal"==w?document.getElementById("ship"):document.getElementById("shrek");
c.globalAlpha=this.alpha;c.drawImage(a,this.x,this.y,this.width,this.height);c.globalAlpha=1},shoot:function(){switch(K){case "single":k.push(ca({x:this.x+this.width/2,y:this.y,xSpeed:0}));break;case "double":for(var a=0;a<=I;a++)k.push(ca({x:8*a+(this.x+this.width/2)-4*I,y:this.y,xSpeed:(5*a-2.5*I)/da}));break;case "laser":k.push(ma({x:this.x+this.width/2,y:this.y-e}))}}},T=0;40>T;T++)starWidth=4*Math.random(),q.push(fa({y:Math.random()*e,width:starWidth,speed:(5+5*starWidth)*y}));var R={left:{x:30,
y:e-120,width:30,height:60,image:document.getElementById("arrowright")},right:{x:120,y:e-120,width:30,height:60,image:document.getElementById("arrowleft")},up:{x:60,y:e-150,width:60,height:30,image:document.getElementById("arrowup")},down:{x:60,y:e-60,width:60,height:30,image:document.getElementById("arrowdown")},alpha:0.5,draw:function(){c.globalAlpha=this.alpha;c.drawImage(this.left.image,this.left.x,this.left.y,this.left.width,this.left.height);c.drawImage(this.down.image,this.down.x,this.down.y,
this.down.width,this.down.height);c.drawImage(this.right.image,this.right.x,this.right.y,this.right.width,this.right.height);c.drawImage(this.up.image,this.up.x,this.up.y,this.up.width,this.up.height);c.globalAlpha=1}},ra={x:b-90,y:e-90,width:90,height:90,image:document.getElementById("fire"),alpha:0.5,draw:function(){c.globalAlpha=this.alpha;c.drawImage(this.image,this.x,this.y,this.width,this.height);c.globalAlpha=1}};bgMusic=document.getElementById("bg");allStar=document.getElementById("allstar");
threeFX=document.getElementById("three");threeFX.pause();twoFX=document.getElementById("two");twoFX.pause();oneFX=document.getElementById("one");oneFX.pause();bgMusic.play();bgMusic.loop=!0;allStar.loop=!0;O.addEventListener("touchstart",function(a){Y=!0;qa(a)},!1);O.addEventListener("touchmove",qa,!1);O.addEventListener("touchend",function(){Y=!1},!1);document.body.addEventListener("touchcancel",function(){Y=!1});var ka=3,ga=!0,P=b/16,Q=e/2+b/14});